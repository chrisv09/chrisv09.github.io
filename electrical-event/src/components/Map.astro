---
interface Props {
  nodes: Array<{ id: string; lat: number; lon: number }>;
}

const { nodes } = Astro.props;

// Calculate center point (OpenLayers uses lon, lat)
let centerLon = 174.905;
let centerLat = -36.965;
if (nodes.length > 0) {
  centerLat = nodes.reduce((sum, n) => sum + n.lat, 0) / nodes.length;
  centerLon = nodes.reduce((sum, n) => sum + n.lon, 0) / nodes.length;
}
---

<div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
  <button id="add-random" type="button">Make a guess</button>
  <small>Click map to place base point, press random to add a dot 100m away, then press Connect to draw a line.</small>
</div>

<div id="basicMap" style="width: 100%; height: 100%; position: relative;" data-nodes={JSON.stringify(nodes)} data-center-lat={centerLat} data-center-lon={centerLon}>
  <!-- Overlay for displaying guess result -->
  <div id="guess-overlay" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7); z-index: 100; border-radius: 8px; flex-direction: column; align-items: center; justify-content: center; gap: 16px;">
    <div style="text-align: center;">
      <div id="distance-display" style="font-size: 24px; font-weight: bold; color: white; margin-bottom: 8px;"></div>
      <p style="color: white; margin: 0; font-size: 14px;">Good guess!</p>
    </div>
    <button id="next-round" type="button" style="padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Next round</button>
  </div>
</div>

---

<!-- Load client module from dev-server path so Vite can rewrite imports -->
<script type="module" src="/src/client/map-client.js"></script>

<style>
  @import 'ol/ol.css';

  #basicMap {
    border: 4px solid white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    overflow: hidden;
  }
</style>
